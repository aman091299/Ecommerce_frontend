"use client"
import Image from "next/image";
import { useState } from "react";
import { useDispatch ,useSelector} from "react-redux";
import { addItemsInAddToCart } from "../store/cartSlice";
import { createCart } from "../utils/constants";
import SmallLoader from "./SmallLoader";
import { useMemo } from "react";
const ProductPageContainer = ({
  image,
  name,
  combo,
  serves,
  actualPrice,
  price,
  howToCook,
  description,
  _id,
}) => {
  const [isShowText, setIsShowText] = useState(false);
   const dispatch = useDispatch();
  const [loading,setLoading]=useState(false);


  const cartItems=useSelector(store=>store.cart.cartItems);

 const  productDetails=useMemo(()=>{
  return cartItems.length?cartItems?.filter((item)=> (  item?._id ===_id )):[]

 },[cartItems,_id]);
 const  quantityInCart  =productDetails?.[0]?.itemQuantity || 0;
 




  const handleCartUpdate =async (type) => {
       
         
           let newQuantity=quantityInCart;
       if (type === "add") {
      newQuantity +=1;
    }
     
    if (quantityInCart > 0 &&  type === "remove") {
                 newQuantity -=1;
    }
     if (newQuantity < 0) newQuantity = 0;
     setLoading(true);
    const data=await createCart(_id,newQuantity);
    setLoading(false);
    if(data){
        dispatch(
        addItemsInAddToCart({
          itemQuantity: newQuantity,
          name: name,
          price: price,
          _id: _id,
        })
      );
         }
    }
   

  
  return (
    <div className="h-full">
      <div className="flex gap-6 w-full">
        <div className="w-1/2 px-4 py-4 bg-white shadow-sm rounded">
          <Image src={image[0] || "/default-placeholder.png"} alt="Product Image" height={500} width={600} />

          <Image
            src={image[0]|| "/default-placeholder.png"}
            alt="Product Image"
            height={100}
            width={100}
            className="rounded mx-auto m-10"
          />

          <div>
            <div className="text-sm">
              {!isShowText ? (
                <span>
                  {description.substring(0, 256)}
                  {description.length > 255 && "..."}
                </span>
              ) : (
                <span>{description} </span>
              )}
            </div>
            <div
              className="text-orange-600 text-sm cursor-pointer"
              onClick={() => setIsShowText((prev) => !prev)}
            >
              {description.length > 255 &&
                (!isShowText ? "read more" : "read less")}
            </div>
          </div>
        </div>
        <div className="w-1/2">
          <div className="bg-[#f8f4f2]  shadow-sm w-full ">
            <div className="bg-white  px-4 py-4  rounded">
              <div className="font-semibold text-xl">{name}</div>
              <div className="text-sm font-semibold text-[#a9a9a9] py-1">
                Super Saver Meal
              </div>
              <div className="flex gap-4 py-2 ">
                <div className="bg-blue-100 text-blue-400 text-sm px-1">
                  Combo of {combo}
                </div>
                <div className="bg-green-100 text-green-400 text-sm px-1">
                  Serves: {serves}
                </div>
              </div>
            </div>
            <div className="flex justify-between px-4 py-4">
              <div className="flex items-center">
                <span className="font-semibold text-xl">₹{price}.00</span>
                <span
                  className="ml-2  text-[#a9a9a9] line-through"
                  style={{ textDecorationThickness: "1px" }}
                >
                  ₹{actualPrice}.00
                </span>
              </div>
              {quantityInCart === 0 ? (
                <button
                  className="btn btn-neutral cursor-pointer hover:bg-orange-600 hover:border-orange-600"
                  onClick={()=>handleCartUpdate('add')}
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 15 15"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M2.50008 4.25008H10.6306L10.9222 3.08341H3.66675V1.91675H11.6701C11.7588 1.91675 11.8463 1.93697 11.9259 1.97586C12.0056 2.01476 12.0754 2.0713 12.1299 2.14121C12.1845 2.21111 12.2224 2.29253 12.2408 2.37928C12.2591 2.46603 12.2575 2.55582 12.2359 2.64183L10.7776 8.47516C10.746 8.60131 10.6731 8.71328 10.5706 8.79328C10.4681 8.87329 10.3418 8.91674 10.2117 8.91675H1.91675C1.76204 8.91675 1.61367 8.85529 1.50427 8.74589C1.39487 8.6365 1.33341 8.48812 1.33341 8.33341V1.33341H0.166748V0.166748H1.91675C2.07146 0.166748 2.21983 0.228206 2.32923 0.337602C2.43862 0.446999 2.50008 0.595372 2.50008 0.750081V4.25008ZM2.50008 12.4167C2.19066 12.4167 1.89392 12.2938 1.67512 12.075C1.45633 11.8562 1.33341 11.5595 1.33341 11.2501C1.33341 10.9407 1.45633 10.6439 1.67512 10.4251C1.89392 10.2063 2.19066 10.0834 2.50008 10.0834C2.8095 10.0834 3.10625 10.2063 3.32504 10.4251C3.54383 10.6439 3.66675 10.9407 3.66675 11.2501C3.66675 11.5595 3.54383 11.8562 3.32504 12.075C3.10625 12.2938 2.8095 12.4167 2.50008 12.4167ZM9.50008 12.4167C9.19066 12.4167 8.89392 12.2938 8.67512 12.075C8.45633 11.8562 8.33341 11.5595 8.33341 11.2501C8.33341 10.9407 8.45633 10.6439 8.67512 10.4251C8.89392 10.2063 9.19066 10.0834 9.50008 10.0834C9.8095 10.0834 10.1062 10.2063 10.325 10.4251C10.5438 10.6439 10.6667 10.9407 10.6667 11.2501C10.6667 11.5595 10.5438 11.8562 10.325 12.075C10.1062 12.2938 9.8095 12.4167 9.50008 12.4167Z"
                      fill="white"
                    ></path>
                  </svg>
                  {loading?<SmallLoader/>:'Add to Cart'}
                </button>
              ) : (
                <div className="flex gap-5 bg-orange-600 rounded px-4 text-white py-1 text-2xl cursor-pointer">
                                    <button
                    onClick={() =>handleCartUpdate("remove")}
                  >
                    -
                  </button>
                  <div>  {loading?<SmallLoader/>:quantityInCart}</div>
                  <button
                    onClick={() => handleCartUpdate("add")}
                  >
                    +
                  </button>
                </div>
              )}
            </div>
          </div>
          <div className="mt-4 w-full">
            <div className="bg-white w-full rounded shadow-sm py-2 px-4 flex items-center gap-3">
              <span className="text-orange-600 "> How to Cook </span>
              <span>
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.77958 9.22042C7.13445 9.55799 7.13445 10.1119 6.77958 10.4495C6.44201 10.7871 5.88806 10.7871 5.5505 10.4495C4.73981 9.63759 4.28447 8.53714 4.28447 7.38979C4.28447 6.24244 4.73981 5.14198 5.5505 4.33007L8.61454 1.26603C9.42645 0.455339 10.5269 0 11.6743 0C12.8216 0 13.9221 0.455339 14.734 1.26603C15.5447 2.07794 16 3.17839 16 4.32575C16 5.4731 15.5447 6.57355 14.734 7.38546L13.4443 8.67513C13.453 7.96538 13.3404 7.25563 13.0981 6.5805L13.5049 6.16504C13.7475 5.92501 13.9402 5.63924 14.0716 5.32427C14.2031 5.0093 14.2708 4.67138 14.2708 4.33007C14.2708 3.98877 14.2031 3.65085 14.0716 3.33588C13.9402 3.02091 13.7475 2.73514 13.5049 2.49511C13.2649 2.25246 12.9791 2.05983 12.6641 1.92837C12.3492 1.7969 12.0112 1.72921 11.6699 1.72921C11.3286 1.72921 10.9907 1.7969 10.6757 1.92837C10.3608 2.05983 10.075 2.25246 9.83496 2.49511L6.77958 5.5505C6.53693 5.79052 6.3443 6.07629 6.21283 6.39127C6.08137 6.70624 6.01367 7.04415 6.01367 7.38546C6.01367 7.72677 6.08137 8.06469 6.21283 8.37966C6.3443 8.69463 6.53693 8.9804 6.77958 9.22042ZM9.22042 5.5505C9.55799 5.21293 10.1119 5.21293 10.4495 5.5505C11.2602 6.36241 11.7155 7.46286 11.7155 8.61021C11.7155 9.75756 11.2602 10.858 10.4495 11.6699L7.38546 14.734C6.57355 15.5447 5.4731 16 4.32575 16C3.17839 16 2.07794 15.5447 1.26603 14.734C0.455339 13.9221 0 12.8216 0 11.6743C0 10.5269 0.455339 9.42645 1.26603 8.61454L2.5557 7.32487C2.54704 8.03462 2.65956 8.74437 2.90192 9.42815L2.49511 9.83496C2.25246 10.075 2.05983 10.3608 1.92837 10.6757C1.7969 10.9907 1.72921 11.3286 1.72921 11.6699C1.72921 12.0112 1.7969 12.3492 1.92837 12.6641C2.05983 12.9791 2.25246 13.2649 2.49511 13.5049C2.73514 13.7475 3.02091 13.9402 3.33588 14.0716C3.65085 14.2031 3.98877 14.2708 4.33007 14.2708C4.67138 14.2708 5.0093 14.2031 5.32427 14.0716C5.63924 13.9402 5.92501 13.7475 6.16504 13.5049L9.22042 10.4495C9.46307 10.2095 9.6557 9.92371 9.78717 9.60874C9.91864 9.29377 9.98633 8.95585 9.98633 8.61454C9.98633 8.27323 9.91864 7.93532 9.78717 7.62035C9.6557 7.30537 9.46307 7.0196 9.22042 6.77958C9.13636 6.70081 9.06935 6.60562 9.02354 6.49992C8.97773 6.39422 8.9541 6.28024 8.9541 6.16504C8.9541 6.04983 8.97773 5.93586 9.02354 5.83015C9.06935 5.72445 9.13636 5.62927 9.22042 5.5505Z"
                    fill="#E76E1E"
                  ></path>
                </svg>
              </span>
            </div>
          </div>
          <div className="mt-4 flex w-full justify-between px-4 bg-[#f9f9f9] shadow-sm py-4">
            <div className="text-sm flex flex-col gap-2">
              <div className="flex gap-3 items-center">
                <span>
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 14 14"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M13.1163 5.42625C12.8806 5.18 12.6369 4.92625 12.545 4.70312C12.46 4.49875 12.455 4.16 12.45 3.83187C12.4406 3.22187 12.4306 2.53062 11.95 2.05C11.4694 1.56937 10.7781 1.55937 10.1681 1.55C9.84 1.545 9.50125 1.54 9.29688 1.455C9.07438 1.36312 8.82 1.11937 8.57375 0.88375C8.1425 0.469375 7.6525 0 7 0C6.3475 0 5.85812 0.469375 5.42625 0.88375C5.18 1.11937 4.92625 1.36312 4.70312 1.455C4.5 1.54 4.16 1.545 3.83187 1.55C3.22187 1.55937 2.53062 1.56937 2.05 2.05C1.56937 2.53062 1.5625 3.22187 1.55 3.83187C1.545 4.16 1.54 4.49875 1.455 4.70312C1.36312 4.92562 1.11937 5.18 0.88375 5.42625C0.469375 5.8575 0 6.3475 0 7C0 7.6525 0.469375 8.14187 0.88375 8.57375C1.11937 8.82 1.36312 9.07375 1.455 9.29688C1.54 9.50125 1.545 9.84 1.55 10.1681C1.55937 10.7781 1.56937 11.4694 2.05 11.95C2.53062 12.4306 3.22187 12.4406 3.83187 12.45C4.16 12.455 4.49875 12.46 4.70312 12.545C4.92562 12.6369 5.18 12.8806 5.42625 13.1163C5.8575 13.5306 6.3475 14 7 14C7.6525 14 8.14187 13.5306 8.57375 13.1163C8.82 12.8806 9.07375 12.6369 9.29688 12.545C9.50125 12.46 9.84 12.455 10.1681 12.45C10.7781 12.4406 11.4694 12.4306 11.95 11.95C12.4306 11.4694 12.4406 10.7781 12.45 10.1681C12.455 9.84 12.46 9.50125 12.545 9.29688C12.6369 9.07438 12.8806 8.82 13.1163 8.57375C13.5306 8.1425 14 7.6525 14 7C14 6.3475 13.5306 5.85812 13.1163 5.42625ZM9.85375 5.85375L6.35375 9.35375C6.30731 9.40024 6.25217 9.43712 6.19147 9.46228C6.13077 9.48744 6.06571 9.50039 6 9.50039C5.93429 9.50039 5.86923 9.48744 5.80853 9.46228C5.74783 9.43712 5.69269 9.40024 5.64625 9.35375L4.14625 7.85375C4.05243 7.75993 3.99972 7.63268 3.99972 7.5C3.99972 7.36732 4.05243 7.24007 4.14625 7.14625C4.24007 7.05243 4.36732 6.99972 4.5 6.99972C4.63268 6.99972 4.75993 7.05243 4.85375 7.14625L6 8.29313L9.14625 5.14625C9.19271 5.09979 9.24786 5.06294 9.30855 5.0378C9.36925 5.01266 9.4343 4.99972 9.5 4.99972C9.5657 4.99972 9.63075 5.01266 9.69145 5.0378C9.75214 5.06294 9.80729 5.09979 9.85375 5.14625C9.90021 5.1927 9.93705 5.24786 9.9622 5.30855C9.98734 5.36925 10.0003 5.4343 10.0003 5.5C10.0003 5.5657 9.98734 5.63075 9.9622 5.69145C9.93705 5.75214 9.90021 5.8073 9.85375 5.85375Z"
                      fill="#009E4E"
                    ></path>
                  </svg>
                </span>
                <span>
                  Get 20% OFF upto Rs 150/- on 1st purchase above Rs 499/-
                </span>
              </div>
              <div className="flex gap-3 items-center">
                <span>
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 14 14"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M13.1163 5.42625C12.8806 5.18 12.6369 4.92625 12.545 4.70312C12.46 4.49875 12.455 4.16 12.45 3.83187C12.4406 3.22187 12.4306 2.53062 11.95 2.05C11.4694 1.56937 10.7781 1.55937 10.1681 1.55C9.84 1.545 9.50125 1.54 9.29688 1.455C9.07438 1.36312 8.82 1.11937 8.57375 0.88375C8.1425 0.469375 7.6525 0 7 0C6.3475 0 5.85812 0.469375 5.42625 0.88375C5.18 1.11937 4.92625 1.36312 4.70312 1.455C4.5 1.54 4.16 1.545 3.83187 1.55C3.22187 1.55937 2.53062 1.56937 2.05 2.05C1.56937 2.53062 1.5625 3.22187 1.55 3.83187C1.545 4.16 1.54 4.49875 1.455 4.70312C1.36312 4.92562 1.11937 5.18 0.88375 5.42625C0.469375 5.8575 0 6.3475 0 7C0 7.6525 0.469375 8.14187 0.88375 8.57375C1.11937 8.82 1.36312 9.07375 1.455 9.29688C1.54 9.50125 1.545 9.84 1.55 10.1681C1.55937 10.7781 1.56937 11.4694 2.05 11.95C2.53062 12.4306 3.22187 12.4406 3.83187 12.45C4.16 12.455 4.49875 12.46 4.70312 12.545C4.92562 12.6369 5.18 12.8806 5.42625 13.1163C5.8575 13.5306 6.3475 14 7 14C7.6525 14 8.14187 13.5306 8.57375 13.1163C8.82 12.8806 9.07375 12.6369 9.29688 12.545C9.50125 12.46 9.84 12.455 10.1681 12.45C10.7781 12.4406 11.4694 12.4306 11.95 11.95C12.4306 11.4694 12.4406 10.7781 12.45 10.1681C12.455 9.84 12.46 9.50125 12.545 9.29688C12.6369 9.07438 12.8806 8.82 13.1163 8.57375C13.5306 8.1425 14 7.6525 14 7C14 6.3475 13.5306 5.85812 13.1163 5.42625ZM9.85375 5.85375L6.35375 9.35375C6.30731 9.40024 6.25217 9.43712 6.19147 9.46228C6.13077 9.48744 6.06571 9.50039 6 9.50039C5.93429 9.50039 5.86923 9.48744 5.80853 9.46228C5.74783 9.43712 5.69269 9.40024 5.64625 9.35375L4.14625 7.85375C4.05243 7.75993 3.99972 7.63268 3.99972 7.5C3.99972 7.36732 4.05243 7.24007 4.14625 7.14625C4.24007 7.05243 4.36732 6.99972 4.5 6.99972C4.63268 6.99972 4.75993 7.05243 4.85375 7.14625L6 8.29313L9.14625 5.14625C9.19271 5.09979 9.24786 5.06294 9.30855 5.0378C9.36925 5.01266 9.4343 4.99972 9.5 4.99972C9.5657 4.99972 9.63075 5.01266 9.69145 5.0378C9.75214 5.06294 9.80729 5.09979 9.85375 5.14625C9.90021 5.1927 9.93705 5.24786 9.9622 5.30855C9.98734 5.36925 10.0003 5.4343 10.0003 5.5C10.0003 5.5657 9.98734 5.63075 9.9622 5.69145C9.93705 5.75214 9.90021 5.8073 9.85375 5.85375Z"
                      fill="#009E4E"
                    ></path>
                  </svg>
                </span>
                <span>Get Free Delivery on purchase above Rs 699/-</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ProductPageContainer;
